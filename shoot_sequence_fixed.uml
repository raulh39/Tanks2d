@startuml

hide footbox

participant Main as M
participant GUI as G
participant "Roll3D" as R
participant TankList as TL
participant "Shooting\nTank (st)" as ST
participant "Not Shooting\nTank (nst)" as NST
participant "Target\nTank (tt)" as TT
participant "Not Target\nTank (ntt)" as NTT

activate M
M -> G: setPhase(SHOOT)
activate G
M <-- G
deactivate G
M -> TL: reset_tanks()
activate TL
TL -> ST: has_acted = false
TL -> NST: has_acted = false
TL -> TT: has_acted = false
TL -> NTT: has_acted = false
M <-- TL
deactivate TL

loop TanksList.more_to_act()

M -> TL: select_tank_to_shoot()
activate TL

group _select_tank_by_initiative("gt")
group _select([st, nst])
TL -> ST: set_selectable(true)
TL -> NST: set_selectable(true)
ST ->o TL: vehicle_selected(st)
TL -> ST: set_selectable(false)
TL -> NST: set_selectable(false)
end
end
M <-- TL: st
deactivate TL

M -> ST: set_shooting(true)
M -> G : update_shooting_tank_info(st)
activate G
M <-- G
deactivate G

M->TL: select_target_tank(st)
activate TL

TL -> TT: set_targetable(st)
TL -> NTT: set_targetable(st)
TT ->o TL: vehicle_selected
TL -> TT: unset_targetable()
TL -> NTT: unset_targetable()
M <-- TL: tt
deactivate TL

M -> ST: set_shooting(false)

M->R: roll(st.dices)
activate R
M <-- R: result
deactivate R

M->R: roll(tt.dices)
activate R
M <-- R: result
deactivate R

M -> G: hide_info()
activate G
M <-- G
deactivate G

M -> TL: mark_tank_as_acted(st)
activate TL
TL -> ST: has_acted = true
M <-- TL
deactivate TL

end
@enduml
